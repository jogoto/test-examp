#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –∑–∞ —Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ Docker –ø—Ä–∞–≤–∞—Ç–∞ –∑–∞ Jenkins
# –ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Ç–æ–∑–∏ —Å–∫—Ä–∏–ø—Ç –∫–∞—Ç–æ root –∏–ª–∏ —Å sudo

set -e

echo "üîß –†–µ—à–∞–≤–∞–Ω–µ –Ω–∞ Docker –ø—Ä–∞–≤–∞—Ç–∞ –∑–∞ Jenkins..."
echo "=========================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–∏—Ç–µ –≥—Ä—É–ø–∏ –Ω–∞ jenkins –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
echo "üìã –¢–µ–∫—É—â–∏ –≥—Ä—É–ø–∏ –Ω–∞ jenkins –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è:"
groups jenkins

# –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ jenkins –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –≤ docker –≥—Ä—É–ø–∞—Ç–∞
echo "üë§ –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ jenkins –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –≤ docker –≥—Ä—É–ø–∞—Ç–∞..."
usermod -aG docker jenkins

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∞—Ç–∞ –Ω–∞ Docker socket
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∞—Ç–∞ –Ω–∞ Docker socket:"
ls -la /var/run/docker.sock

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≥—Ä—É–ø–∏—Ç–µ —Å–ª–µ–¥ –ø—Ä–æ–º—è–Ω–∞—Ç–∞
echo "üìã –ì—Ä—É–ø–∏ –Ω–∞ jenkins –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è —Å–ª–µ–¥ –ø—Ä–æ–º—è–Ω–∞—Ç–∞:"
groups jenkins

# –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ Jenkins service
echo "üîÑ –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ Jenkins service..."
systemctl restart jenkins

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Jenkins —Å—Ç–∞—Ç—É—Å–∞
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Jenkins —Å—Ç–∞—Ç—É—Å–∞:"
systemctl status jenkins --no-pager

# –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ Docker –ø—Ä–∞–≤–∞—Ç–∞
echo "üß™ –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ Docker –ø—Ä–∞–≤–∞—Ç–∞..."
echo "–ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Å–ª–µ–¥–Ω–∞—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∫–∞—Ç–æ jenkins –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª:"
echo "sudo -u jenkins docker --version"

echo ""
echo "‚úÖ Docker –ø—Ä–∞–≤–∞—Ç–∞ —Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏!"
echo ""
echo "–°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏:"
echo "1. –ò–∑—á–∞–∫–∞–π—Ç–µ Jenkins –¥–∞ —Å–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞ –Ω–∞–ø—ä–ª–Ω–æ"
echo "2. –¢–µ—Å—Ç–≤–∞–π—Ç–µ pipeline-–∞ –æ—Ç–Ω–æ–≤–æ"
echo "3. –ê–∫–æ –≤—Å–µ –æ—â–µ –∏–º–∞ –ø—Ä–æ–±–ª–µ–º–∏, –ø—Ä–æ–≤–µ—Ä–µ—Ç–µ –ª–æ–≥–æ–≤–µ—Ç–µ –Ω–∞ Jenkins" 